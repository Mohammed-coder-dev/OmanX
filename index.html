<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OmanX</title>
    <meta name="description" content="Government-grade onboarding assistant for Omani scholars in the United States." />
    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="data:," />
  </head>

  <body>
    <div class="bg">
      <div class="bg-grid"></div>
      <div class="bg-glow"></div>
      <div class="bg-vignette"></div>
    </div>

    <!-- Drawer overlay + drawer -->
    <div class="overlay" id="overlay" hidden></div>

    <aside class="drawer" id="drawer" role="dialog" aria-modal="true" aria-label="Policy and details" hidden>
      <div class="drawer__head">
        <div class="drawer__title">
          <div class="drawer__kicker muted">OmanX</div>
          <h2>Menu</h2>
        </div>
        <button class="iconbtn" id="closeBtn" type="button" aria-label="Close menu">✕</button>
      </div>

      <div class="drawer__content">
        <!-- Quick actions -->
        <section class="drawer__section">
          <h3>Quick actions</h3>
          <div class="btnrow">
            <button class="primary" id="demoBtn_2" type="button">Run demo flow</button>
            <button class="ghost" id="clearBtn_2" type="button">Clear chat</button>
            <button class="ghost" id="exportBtn_2" type="button">Export last answer</button>
            <button class="ghost" id="copyBtn_2" type="button">Copy last</button>
            <button class="ghost" id="printBtn_2" type="button">Print</button>
            <a class="ghost" href="/health" target="_blank" rel="noreferrer">Health</a>
          </div>
        </section>

        <div class="divider"></div>

        <!-- Playbooks (prompt shortcuts) -->
        <section class="drawer__section">
          <h3>Onboarding playbooks</h3>
          <p class="muted small">Tap to insert a structured request.</p>

          <div class="list2">
            <button
              class="item"
              data-prompt="Build a 24-hour arrival plan with steps, documents to keep accessible, and what to do if something goes wrong."
              type="button"
            >
              <div class="item-title">24-hour arrival plan</div>
              <div class="item-sub muted">Airport → SIM → transport → housing → essentials</div>
            </button>

            <button
              class="item"
              data-prompt="Give me a first-week checklist: SIM, banking, housing basics, campus ID, and who to contact at the university."
              type="button"
            >
              <div class="item-title">First-week checklist</div>
              <div class="item-sub muted">Practical setup + escalation contacts</div>
            </button>

            <button
              class="item"
              data-prompt="I have a question that might affect immigration status. Give me the safest next step and official escalation guidance."
              type="button"
            >
              <div class="item-title">Immigration: safest next step</div>
              <div class="item-sub muted">No guessing, only official guidance</div>
            </button>

            <button
              class="item"
              data-prompt="What documents should I keep accessible during travel and the first 48 hours in the U.S.?"
              type="button"
            >
              <div class="item-title">Travel documents</div>
              <div class="item-sub muted">What to carry + why</div>
            </button>

            <button
              class="item"
              data-prompt="Create a one-page ‘survival guide’ for day 1 in the U.S. for a new student."
              type="button"
            >
              <div class="item-title">Day-1 survival guide</div>
              <div class="item-sub muted">One-page, print-ready</div>
            </button>
          </div>
        </section>

        <div class="divider"></div>

        <!-- Policy -->
        <section class="drawer__section">
          <div class="toggle-row">
            <div>
              <div class="panel-title">Response policy</div>
              <div class="panel-sub muted">Choose the level of strictness.</div>
            </div>

            <div class="segmented" role="tablist" aria-label="Response policy mode">
              <button class="seg on" id="modeOfficial_2" type="button" role="tab" aria-selected="true">
                Official
              </button>
              <button class="seg" id="modeCommunity_2" type="button" role="tab" aria-selected="false">
                Community
              </button>
            </div>
          </div>

          <div class="callout">
            <div class="callout-title" id="modeTitle_2">Official mode</div>
            <div class="callout-text" id="modeText_2">
              Responses must cite approved knowledge. If uncertain, OmanX escalates.
            </div>
          </div>
        </section>

        <div class="divider"></div>

        <!-- Ministry-ready -->
        <section class="drawer__section">
          <h3>Ministry-ready</h3>
          <ul class="bullets">
            <li><strong>Constrained outputs</strong> — OmanX answers from approved sources only.</li>
            <li><strong>Auditability</strong> — Responses are structured and cite references.</li>
            <li><strong>Escalation</strong> — High-stakes topics route to officials.</li>
            <li><strong>Low data risk</strong> — MVP requires minimal personal data.</li>
          </ul>
        </section>

        <div class="divider"></div>

        <!-- Disclaimer -->
        <section class="drawer__section">
          <h3>Disclaimer</h3>
          <p class="muted small">
            Informational guidance only. For immigration/legal/medical matters, follow official instructions and consult the appropriate office.
          </p>
        </section>

        <footer class="drawer__foot">
          <div class="fine muted">
            <span>© <span id="year_2"></span> OmanX</span>
            <span class="fine-dot">•</span>
            <span>Built for clarity under pressure.</span>
          </div>
        </footer>
      </div>
    </aside>

    <main class="shell shell-chat">
      <!-- Top -->
      <header class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <span class="logo-dot"></span>
          </div>
          <div class="brand-text">
            <div class="brand-row">
              <h1>OmanX</h1>
              <span class="badge">Pilot MVP</span>
            </div>
            <p>Government-grade guidance for Omani scholars in the United States.</p>
          </div>
        </div>

        <div class="top-actions">
          <!-- Hamburger / Drawer button -->
          <button
            class="iconbtn"
            id="menuBtn"
            type="button"
            aria-label="Open menu"
            aria-expanded="false"
            aria-controls="drawer"
            title="Menu"
          >
            <span class="hamburger" aria-hidden="true"><span></span></span>
          </button>

          <span class="pill" id="statusPill" title="Service status">
            <span class="pill-dot"></span>
            <span class="pill-text">Online</span>
          </span>
        </div>
      </header>

      <!-- Chat-only main -->
      <section class="layout layout-chat-only">
        <section class="card chat chat-main">
          <div class="card-head chat-head">
            <div>
              <h3>OmanX Assistant</h3>
              <p class="muted">Clear steps. References. Escalation triggers.</p>
            </div>
            <div class="chat-actions">
              <button class="ghost" id="clearBtn" type="button">Clear</button>
            </div>
          </div>

          <div id="chat" class="chat-scroll chat-scroll-main" role="log" aria-live="polite"></div>

          <div class="composer composer-main">
            <form id="form" class="composer-row">
              <div class="input-wrap">
                <textarea
                  id="input"
                  rows="2"
                  placeholder="Ask about arrival, banking, SIM, housing, campus onboarding…"
                ></textarea>
                <div class="hint">
                  <kbd>Enter</kbd> send · <kbd>Shift</kbd>+<kbd>Enter</kbd> newline
                </div>
              </div>

              <button id="send" class="send" type="submit">
                <span class="send-text">Send</span>
                <span class="send-icon" aria-hidden="true">↵</span>
              </button>
            </form>

            <p class="disclaimer">
              Disclaimer: informational guidance only. For immigration/legal/medical matters, follow official instructions and contact the appropriate office.
            </p>
          </div>

          <footer class="side-foot">
            <div class="fine muted">
              <span>© <span id="year"></span> OmanX</span>
              <span class="fine-dot">•</span>
              <span>Built for clarity under pressure.</span>
            </div>
          </footer>
        </section>
      </section>
    </main>

    <script>
      // Drawer open/close + wiring
      (function () {
        const drawer = document.getElementById("drawer");
        const overlay = document.getElementById("overlay");
        const menuBtn = document.getElementById("menuBtn");
        const closeBtn = document.getElementById("closeBtn");

        function openDrawer() {
          drawer.hidden = false;
          overlay.hidden = false;
          drawer.dataset.open = "true";
          overlay.dataset.open = "true";
          menuBtn?.setAttribute("aria-expanded", "true");
          closeBtn?.focus();
          document.body.classList.add("no-scroll");
        }

        function closeDrawer() {
          drawer.dataset.open = "false";
          overlay.dataset.open = "false";
          menuBtn?.setAttribute("aria-expanded", "false");
          document.body.classList.remove("no-scroll");
          window.setTimeout(() => {
            drawer.hidden = true;
            overlay.hidden = true;
          }, 180);
          menuBtn?.focus();
        }

        menuBtn?.addEventListener("click", openDrawer);
        closeBtn?.addEventListener("click", closeDrawer);
        overlay?.addEventListener("click", closeDrawer);

        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !drawer.hidden) closeDrawer();
        });

        // Mirror year
        const y = new Date().getFullYear();
        const yearA = document.getElementById("year");
        const yearB = document.getElementById("year_2");
        if (yearA) yearA.textContent = String(y);
        if (yearB) yearB.textContent = String(y);

        // Sync policy toggles (drawer only)
        function setMode(mode) {
          const isOfficial = mode === "official";
          const bO = document.getElementById("modeOfficial_2");
          const bC = document.getElementById("modeCommunity_2");

          bO?.classList.toggle("on", isOfficial);
          bC?.classList.toggle("on", !isOfficial);

          bO?.setAttribute("aria-selected", String(isOfficial));
          bC?.setAttribute("aria-selected", String(!isOfficial));

          const title = isOfficial ? "Official mode" : "Community mode";
          const text = isOfficial
            ? "Responses must cite approved knowledge. If uncertain, OmanX escalates."
            : "Responses may include community tips. Use caution; verify with official offices for high-stakes topics.";

          const modeTextDrawer = document.getElementById("modeText_2");
          const modeTitleDrawer = document.getElementById("modeTitle_2");

          if (modeTextDrawer) modeTextDrawer.textContent = text;
          if (modeTitleDrawer) modeTitleDrawer.textContent = title;
        }

        document.getElementById("modeOfficial_2")?.addEventListener("click", () => setMode("official"));
        document.getElementById("modeCommunity_2")?.addEventListener("click", () => setMode("community"));

        // Wire drawer buttons to main buttons (so your existing app.js keeps working)
        const demoBtn = document.getElementById("demoBtn");
        const clearBtn = document.getElementById("clearBtn");
        const exportBtn = document.getElementById("exportBtn");
        const copyBtn = document.getElementById("copyBtn");
        const printBtn = document.getElementById("printBtn");

        document.getElementById("demoBtn_2")?.addEventListener("click", () => { demoBtn?.click(); closeDrawer(); });
        document.getElementById("clearBtn_2")?.addEventListener("click", () => { clearBtn?.click(); closeDrawer(); });

        document.getElementById("exportBtn_2")?.addEventListener("click", () => exportBtn?.click());
        document.getElementById("copyBtn_2")?.addEventListener("click", () => copyBtn?.click());

        // Print: if you don't have a main print button anymore, just call window.print()
        document.getElementById("printBtn_2")?.addEventListener("click", () => window.print());

        // Playbook buttons: click inserts prompt and closes drawer
        const input = document.getElementById("input");
        drawer.querySelectorAll("button.item[data-prompt]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const prompt = btn.getAttribute("data-prompt") || "";
            if (input) {
              input.value = prompt;
              input.focus();
            }
            closeDrawer();
          });
        });
      })();
    </script>

    <script src="/app.js"></script>
  </body>
</html>
